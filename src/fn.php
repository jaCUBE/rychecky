<?php

/**
 * Vypisuje jeden ze dvou řetězců dle jazyka.
 * @param string $cs Řetězec pro českou mutaci
 * @param string $en Řetězec pro anglickou mutaci
 * @return string Výsledný řetězec
 */

function e(string $cs = '', string $en = ''): string
{
    return \Rychecky\Language::getLocale() === 'cs' ? $cs : $en;
}


/**
 * Odstranění české diakritiky z řetězce v parametru.
 * @param string $string Název s předpokládanou diakritikou
 * @return string Řetězec s odstraněnou diakritikou
 */

function replace_czech_characters(string $string): string
{
    $original = [
        'á',
        'č',
        'ď',
        'é',
        'ě',
        'í',
        'ľ',
        'ň',
        'ó',
        'ř',
        'š',
        'ť',
        'ú',
        'ů',
        'ý',
        'ž',
        'Á',
        'Č',
        'Ď',
        'É',
        'Ě',
        'Í',
        'Ľ',
        'Ň',
        'Ó',
        'Ř',
        'Š',
        'Ť',
        'Ú',
        'Ů',
        'Ý',
        'Ž',
        'ö',
        'ü'
    ]; // Česká diakritika
    $replace = [
        'a',
        'c',
        'd',
        'e',
        'e',
        'i',
        'l',
        'n',
        'o',
        'r',
        's',
        't',
        'u',
        'u',
        'y',
        'z',
        'A',
        'C',
        'D',
        'E',
        'E',
        'I',
        'L',
        'N',
        'O',
        'R',
        'S',
        'T',
        'U',
        'U',
        'Y',
        'Z',
        'o',
        'u'
    ]; // Znaky bez diakritiky

    return str_replace($original, $replace, $string); // Vrací řetězec s odstraněnou diakritikou
}


/**
 * Převádí pole ve formátu 'atribut => hodnota' na CSS.
 * @param \Rychecky\Collection Collection of CSS properties
 * @return string In-line CSS style
 */

function array_to_css(\Rychecky\Collection $array): string
{
    $css = '';

    foreach ($array as $property => $value) {
        $css .= $property . ': ' . $value . ';';
    }

    return $css;
}


/**
 * Převádí řetěžec do formátu názvu CSS třídy.   *
 * @param string $string Vstup k přípravě na CSS třídu.
 * @return string Formátovaný řetězec na CSS třídu.
 */

function make_css_name(string $string): string
{
    $string = replace_czech_characters($string); // Odstranění diakritiky

    $original = [':', '.', '/', ' ', '(', ')', ',', '[', ']', '_'];
    $replace = ['', '-', '-', '-', '-', '-', '', '-', '', '-'];

    $string = str_replace($original, $replace, $string);
    $string = mb_strtolower($string);

    return $string;
}


/**
 * Generuje odkaz na JS/CSS soubor společně s jeho hashem v GET kvůli cache.
 * @param string $asset Cesta k JS/CSS souboru
 * @return string URL společně s hashem souboru
 */

function asset_with_hash(string $asset): string
{
    return URL . '/' . $asset . '?sha1=' . sha1_file($asset);
}


/**
 * Získává hodnotu proměnné prostředí dle názvu (alternativa k getenv(), které fungovalo divně).
 * @param string $name Název proměnné prostředí
 * @return string Hodnota proměnné prostředí
 */

function env(string $name): string
{
    return (string)$_ENV[$name] ?? $_SERVER[$name]; // $_ENV má přednost
}

/**
 * Poskytuje hodnotu akce z routingu, důležité zejména pro řadič.
 * @return string Hodnota akce
 */
function action(): string
{
    return preg_replace('/^(\/)/', '', $_SERVER['REQUEST_URI']);
}